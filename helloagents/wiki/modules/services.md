# services

## 目的
承载核心业务逻辑（Grok 调用、Token 管理、代理池、内置 Clash 管理等）。

## 模块概述
- **职责:** 对外提供可复用的业务服务，供 API 层调用
- **状态:** ✅稳定
- **最后更新:** 2026-01-15

## 规范

### 需求: 内置 Clash 可用性
**模块:** services
订阅更新、节点切换与启停必须可用，且对常见订阅格式具备兼容性。

#### 场景: Base64 URI 订阅（含 hysteria2）
前置条件
- 订阅链接返回 base64 编码文本
- 解码后为多行 `xxx://` URI 列表，包含 `hysteria2://`
- 预期结果: 更新订阅后，节点列表包含 hysteria2 节点，并可切换使用

#### 场景: 节点切换不再报 404
前置条件
- Clash 已启动
- 预期结果: 后端自动发现可切换的代理组并切换成功，失败时给出明确错误

#### 场景: stop 稳定生效
前置条件
- Clash 已启动并写入 PID
- 预期结果: stop 后进程退出，状态接口返回 `running=false`

## API接口
见 `wiki/api.md`

## 数据模型
见 `wiki/data.md`

## 依赖
- core

## 变更历史
后续按 `helloagents/history/` 记录索引补齐。

